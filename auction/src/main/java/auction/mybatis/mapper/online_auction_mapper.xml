<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="auction.repository.online.OnlineDaoImpl">
	
	<!-- 진행경매 목록 -->
	<select id="currentList" resultType="view">
		select rownum, tmp.* from(
			select * from auction_view 
				where sysdate between 
					to_date(a_start, 'YY/MM/DD HH24:MI') 
				and 
				to_date(a_end, 'YY/MM/DD HH24:MI')
		)tmp order by rownum desc
	</select>
	
	<!-- 진행경매 검색 -->	
	<select id="currentSearch" resultType="view" parameterType="search">
		select * from(
			select rownum as lot, tmp.* from(
				select * from auction_view
			)tmp 
		)where no=4 artist like '%'||#{artist}||'%' or title like '%'||#{title}||'%' or lot=#{lot}
	</select>
	
	<!-- 예정경매 목록 -->
	<select id="upcomingList" resultType="auction" parameterType="paging">
		select * from(
			select rownum as rn, tmp.* from(
				select * from auction_main 
					where to_date(auction_start, 'YY/MM/DD HH24:MI')>sysdate
				order by auction_sq asc
			)tmp
		) where rn between #{sn} and #{fn}
	</select>
	
	<!-- 경매결과 -->
	<select id="resultList" resultType="auction" parameterType="paging">
		select * from(
			select rownum as rn, tmp.* from(
				select * from auction_main 
					where sysdate>to_date(auction_end, 'YY/MM/DD HH24:MI') 
				order by auction_sq desc
			)tmp
		) where rn between #{sn} and #{fn}
	</select>
	
	<select id="count" resultType="integer">
		select count(*) from auction_main where sysdate>to_date(auction_end, 'YY/MM/DD HH24:MI')
	</select>
</mapper>


